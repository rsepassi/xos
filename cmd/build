#!/bin/sh
pkg=$1
if [ -z "$pkg" ]
then
  echo "must provide package"
  exit 1
fi

root=$PWD

# symlink tools
tools_dir=$root/build/tools
tools="
mkdir
rm
cp
dirname
tar
wget
zig
sha256sum
shasum
cut
mktemp
head
tail
"
./tools/link_tools $tools_dir "$tools"

# seal env
build_out=$root/build/out
rm -rf $build_out
mkdir -p $build_out
env -i \
  PATH="$tools_dir:$root/tools" \
  HOME=$root/build/home \
  BUILD_DL=$root/build/dl \
  BUILD_OUT=$build_out \
  BUILD_PKG=$root/pkg/$pkg \
/bin/sh $root/pkg/$pkg/build.sh || echo error
